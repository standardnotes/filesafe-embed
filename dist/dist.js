module.exports=function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=13)}([function(e,t){e.exports=require("react")},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t,n){e.exports=n(12)},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}e.exports=function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e}},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,n){var a=n(10),r=n(2);e.exports=function(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?r(e):t}},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){var a=n(11);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}},function(e,t){e.exports=require("react-dom")},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=a=function(e){return n(e)}:e.exports=a=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},a(t)}e.exports=a},function(e,t){function n(t,a){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,a)}e.exports=n},function(e,t,n){var a=function(e){"use strict";var t,n=Object.prototype,a=n.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function l(e,t,n,a){var r=t&&t.prototype instanceof m?t:m,i=Object.create(r.prototype),s=new C(a||[]);return i._invoke=function(e,t,n){var a=u;return function(r,i){if(a===d)throw new Error("Generator is already running");if(a===p){if("throw"===r)throw i;return I()}for(n.method=r,n.arg=i;;){var s=n.delegate;if(s){var o=N(s,n);if(o){if(o===h)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===u)throw a=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=d;var l=c(e,t,n);if("normal"===l.type){if(a=n.done?p:f,l.arg===h)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(a=p,n.method="throw",n.arg=l.arg)}}}(e,n,s),i}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u="suspendedStart",f="suspendedYield",d="executing",p="completed",h={};function m(){}function g(){}function v(){}var y={};y[i]=function(){return this};var b=Object.getPrototypeOf,w=b&&b(b(D([])));w&&w!==n&&a.call(w,i)&&(y=w);var k=v.prototype=m.prototype=Object.create(y);function E(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function F(e){var t;this._invoke=function(n,r){function i(){return new Promise((function(t,i){!function t(n,r,i,s){var o=c(e[n],e,r);if("throw"!==o.type){var l=o.arg,u=l.value;return u&&"object"==typeof u&&a.call(u,"__await")?Promise.resolve(u.__await).then((function(e){t("next",e,i,s)}),(function(e){t("throw",e,i,s)})):Promise.resolve(u).then((function(e){l.value=e,i(l)}),(function(e){return t("throw",e,i,s)}))}s(o.arg)}(n,r,t,i)}))}return t=t?t.then(i,i):i()}}function N(e,n){var a=e.iterator[n.method];if(a===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,N(e,n),"throw"===n.method))return h;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var r=c(a,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,h;var i=r.arg;return i?i.done?(n[e.resultName]=i.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,h):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,h)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function D(e){if(e){var n=e[i];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,s=function n(){for(;++r<e.length;)if(a.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=t,n.done=!0,n};return s.next=s}}return{next:I}}function I(){return{value:t,done:!0}}return g.prototype=k.constructor=v,v.constructor=g,v[o]=g.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,o in e||(e[o]="GeneratorFunction")),e.prototype=Object.create(k),e},e.awrap=function(e){return{__await:e}},E(F.prototype),F.prototype[s]=function(){return this},e.AsyncIterator=F,e.async=function(t,n,a,r){var i=new F(l(t,n,a,r));return e.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},E(k),k[o]="Generator",k[i]=function(){return this},k.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var a=t.pop();if(a in e)return n.value=a,n.done=!1,n}return n.done=!0,n}},e.values=D,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(S),!e)for(var n in this)"t"===n.charAt(0)&&a.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(a,r){return o.type="throw",o.arg=e,n.next=a,r&&(n.method="next",n.arg=t),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i],o=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var l=a.call(s,"catchLoc"),c=a.call(s,"finallyLoc");if(l&&c){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(l){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=e,s.arg=t,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var a=n.completion;if("throw"===a.type){var r=a.arg;S(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,a){return this.delegate={iterator:D(e),resultName:n,nextLoc:a},"next"===this.method&&(this.arg=t),h}},e}(e.exports);try{regeneratorRuntime=a}catch(e){Function("r","regeneratorRuntime = r")(a)}},function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(9),s=n.n(i),o=n(5),l=n.n(o),c=n(6),u=n.n(c),f=n(7),d=n.n(f),p=n(4),h=n.n(p),m=n(8),g=n.n(m),v=n(2),y=n.n(v),b=n(1),w=n.n(b),k=function(){function e(){l()(this,e),this.unloadHandlers=[],this.dataChangeObservers=[]}return h()(e,null,[{key:"get",value:function(){return null==this.instance&&(this.instance=new e),this.instance}}]),h()(e,[{key:"setFilesafeInstance",value:function(e){var t=this;this.filesafe=e,this.fsObserver=e.addDataChangeObserver((function(){var e=!0,n=!1,a=void 0;try{for(var r,i=t.dataChangeObservers[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){(0,r.value)()}}catch(e){n=!0,a=e}finally{try{e||null==i.return||i.return()}finally{if(n)throw a}}}))}},{key:"setDelegate",value:function(e){this.delegate=e}},{key:"getDelegate",value:function(){return this.delegate||{}}},{key:"addDataChangeObserver",value:function(e){this.dataChangeObservers.push(e)}},{key:"addUnloadHandler",value:function(e){this.unloadHandlers.push(e)}},{key:"unload",value:function(){var t=!0,n=!1,a=void 0;try{for(var r,i=this.unloadHandlers[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){(0,r.value)()}}catch(e){n=!0,a=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw a}}this.dataChangeObservers=[],this.filesafe&&this.filesafe.removeDataChangeObserver(this.fsObserver),e.instance=null}},{key:"defaultRelayServerUrl",value:function(){return window.default_fs_relay_server_url||"https://filesafe.standardnotes.org"}}]),e}();w()(k,"instance",null);var E=function(e){function t(e){var n;return l()(this,t),n=u()(this,d()(t).call(this,e)),w()(y()(n),"exportCredential",(function(e){var t=btoa(JSON.stringify(e,null,2));k.get().filesafe.downloadBase64Data({base64Data:t,fileName:"sn-filesafe-keys-".concat(e.created_at.toISOString(),".json"),fileType:"text/json"})})),w()(y()(n),"deleteCredential",(function(e){0==n.numFilesForCredential(e)?k.get().filesafe.deleteCredential(e):alert("This key has files encrypted with it and cannot be deleted. First delete any associated files, then try again.")})),w()(y()(n),"createNewKeys",(function(){k.get().filesafe.createNewCredentials()})),w()(y()(n),"labelForCredential",(function(e){return e.created_at.toLocaleString()})),w()(y()(n),"numFilesForCredential",(function(e){return k.get().filesafe.numberOfFilesEncryptedWithCredential(e)})),w()(y()(n),"setCredentialAsDefault",(function(e){k.get().filesafe.setCredentialAsDefault(e)})),n.state={credentials:k.get().filesafe.getAllCredentials()||[]},k.get().addDataChangeObserver((function(){n.setState({credentials:k.get().filesafe.getAllCredentials()})})),n}return g()(t,e),h()(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("div",{className:"sk-panel-row"},r.a.createElement("div",{className:"sk-h2 sk-bold"},"Keys"),r.a.createElement("div",{className:"sk-button info no-border",onClick:this.createNewKeys},r.a.createElement("div",{className:"sk-label"},"Create New"))),r.a.createElement("div",{className:"list-container"},this.state.credentials.map((function(t){return r.a.createElement("div",{className:"list-item sk-horizontal-group top"},r.a.createElement("div",{className:"sk-circle x-small "+(t.content.isDefault?"info":"sk-secondary-contrast")}),r.a.createElement("div",null,r.a.createElement("div",{className:"sk-panel-row condensed sk-bold"},e.labelForCredential(t)),r.a.createElement("div",{style:{marginTop:3},className:"sk-panel-row condensed"},e.numFilesForCredential(t)," encrypted files"),r.a.createElement("div",{className:"sk-panel-row condensed"},r.a.createElement("div",{className:"sk-horizontal-group"},e.state.credentials.length>1&&!t.content.isDefault&&r.a.createElement("a",{className:"info",onClick:function(){e.setCredentialAsDefault(t)}},"Make Default"),r.a.createElement("a",{className:"info",onClick:function(){e.exportCredential(t)}},"Export"),r.a.createElement("a",{className:"danger",onClick:function(){e.deleteCredential(t)}},"Delete")))))}))))}}]),t}(r.a.Component),F=n(3),N=n.n(F),x=function(){function e(t){var n=t.credentialManager,a=t.integrationManager;l()(this,e),this.credentialManager=n,this.integrationManager=a}return h()(e,[{key:"getMessages",value:function(){var e,t;return N.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return e=[],n.next=3,N.a.awrap(this.credentialManager.getDefaultCredentials());case 3:return n.sent||e.push({message:"Create keys by selecting <strong>Create New</strong> under <i>Keys</i>.",css:"sk-base"}),(t=this.integrationManager.integrations)&&0!=t.length||e.push({message:"Add a new integration by selecting <strong>Add New</strong> under <i>Integrations</i>",css:"sk-base"}),n.abrupt("return",e);case 8:case"end":return n.stop()}}),null,this)}}]),e}(),S=function(e){function t(e){var n;return l()(this,t),(n=u()(this,d()(t).call(this,e))).state={},n}return g()(t,e),h()(t,[{key:"render",value:function(){return r.a.createElement("div",{id:"messages"},r.a.createElement("div",{className:"title"},"Complete the following steps before uploading your first file:"),r.a.createElement("ul",null,this.props.messages.map((function(e){return r.a.createElement("li",{dangerouslySetInnerHTML:{__html:e.message},className:e.css})}))))}}]),t}(r.a.Component),C=function(e){function t(e){var n;return l()(this,t),n=u()(this,d()(t).call(this,e)),w()(y()(n),"setStatusForFile",(function(e,t,a){n.setState({fileStatusFile:e,fileStatus:t,hasStatusSpinner:a})})),w()(y()(n),"decryptFileDescriptor",(function(e){var t,a;return N.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(t=k.get().filesafe.integrationForFileDescriptor(e)){r.next=4;break}return alert("Unable to find integration for file. If you have deleted the integration, please re-add it and try again."),r.abrupt("return");case 4:return a=k.get().filesafe.displayStringForIntegration(t),n.setStatusForFile(e,"Downloading from ".concat(a,"..."),!0),r.abrupt("return",k.get().filesafe.downloadFileFromDescriptor(e).then((function(t){return n.setStatusForFile(e,"Decrypting...",!0),k.get().filesafe.decryptFile({fileDescriptor:e,fileItem:t}).then((function(t){return{base64Data:t.decryptedData,fileName:e.content.fileName,fileType:e.content.fileType}})).catch((function(t){console.error("filesafe-embed | error decrypting file:",t),n.flashErrorForFileDescriptor(e,"Error decrypting file.")}))})).catch((function(t){console.error("Error downloading file",t),n.flashErrorForFileDescriptor(e,"Error downloading file.")})));case 7:case"end":return r.stop()}}))})),w()(y()(n),"downloadFile",(function(e){var t,a;return N.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(!n.isMobile){r.next=5;break}return t=k.get().filesafe.getPlatform(),alert("Downloading files is not currently supported on ".concat("ios"==t?"iOS":"Android",".")),r.abrupt("return");case 5:return r.next=7,N.a.awrap(n.decryptFileDescriptor(e));case 7:if(a=r.sent){r.next=11;break}return console.error("decryptFile returned nil data"),r.abrupt("return");case 11:k.get().filesafe.downloadBase64Data(a),n.setStatusForFile(e,null);case 13:case"end":return r.stop()}}))})),w()(y()(n),"previewFile",(function(e){var t,a;return N.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,N.a.awrap(n.decryptFileDescriptor(e));case 2:t=r.sent,a=k.get().filesafe.createTemporaryFileUrl({base64Data:t.base64Data,dataType:t.fileType}),n.setStatusForFile(e,null),n.setState({previewUrl:a,previewingFile:e});case 6:case"end":return r.stop()}}))})),w()(y()(n),"onClickPreview",(function(){setTimeout((function(){n.revokePreview()}),500)})),w()(y()(n),"selectFile",(function(e,t){e.target.focus(),n.state.selectedFile==t?(n.setState({selectedFile:null}),n.delegate.onSelectFile&&n.delegate.onSelectFile(null)):(n.setState({selectedFile:t}),n.delegate.onSelectFile&&n.delegate.onSelectFile(t)),n.revokePreview()})),w()(y()(n),"deleteFile",(function(e){k.get().filesafe.deleteFileFromDescriptor(e)})),w()(y()(n),"copyInsertionLink",(function(e){var t="[FileSafe:".concat(e.uuid,":").concat(e.content.fileName,"]");k.get().filesafe.copyTextToClipboard(t),n.setState({copiedLink:e}),setTimeout((function(){n.setState({copiedLink:null})}),1e3)})),w()(y()(n),"isFileSelected",(function(e){return n.state.selectedFile==e})),w()(y()(n),"elementForFile",(function(e){var t,a=k.get().filesafe.integrationForFileDescriptor(e);t=a?k.get().filesafe.displayStringForIntegration(a):"Integration Not Found";var i=e.content.serverMetadata.file_path,s=n.state.previewUrl&&n.state.previewingFile==e,o=n.state.fileStatusFile==e&&n.state.fileStatus,l=n.state.hasStatusSpinner;return r.a.createElement("div",{className:"file-item-container "+(n.isFileSelected(e)?"expanded":"")},r.a.createElement("div",{onClick:function(t){n.selectFile(t,e)},className:"file-item-button sk-button info "+(n.isFileSelected(e)?"selected":void 0)},r.a.createElement("div",{className:"sk-label"},e.content.fileName),o&&r.a.createElement("div",{className:"file-download-status sk-horizontal-group"},l&&r.a.createElement("div",{className:"sk-spinner x-small"}),r.a.createElement("div",{className:"file-status-label"},n.state.fileStatus)),n.isFileSelected(e)&&r.a.createElement("div",{className:"file-item-options-wrapper"},r.a.createElement("div",{onClick:function(e){e.stopPropagation()},className:"sk-app-bar file-item-options"},r.a.createElement("div",{className:"center"},r.a.createElement("div",{onClick:function(t){t.stopPropagation(),n.downloadFile(e)},className:"sk-app-bar-item"},r.a.createElement("div",{className:"sk-label contrast "+(n.isMobile?"disabled":"")},"Download")),r.a.createElement("div",{className:"sk-app-bar-item border"}),n.supportsPreviews&&s&&r.a.createElement("a",{className:"sk-app-bar-item",href:n.state.previewUrl,onClick:function(e){e.stopPropagation(),n.onClickPreview()},target:"_blank"},r.a.createElement("div",{className:"sk-label contrast"},"Open Preview")),n.supportsPreviews&&!s&&r.a.createElement("div",{onClick:function(t){t.stopPropagation(),n.previewFile(e)},className:"sk-app-bar-item"},r.a.createElement("div",{className:"sk-label contrast "+(n.isMobile?"disabled":"")},"Preview")),n.supportsPreviews&&r.a.createElement("div",{className:"sk-app-bar-item border"}),r.a.createElement("div",{onClick:function(t){t.stopPropagation(),n.copyInsertionLink(e)},className:"sk-app-bar-item"},r.a.createElement("div",{className:"sk-label contrast"},n.state.copiedLink==e?"Copied":"Copy Insert Link")),r.a.createElement("div",{className:"sk-app-bar-item border"}),r.a.createElement("div",{onClick:function(t){t.stopPropagation(),n.deleteFile(e)},className:"sk-app-bar-item"},r.a.createElement("div",{className:"sk-label contrast"},"Delete")))),r.a.createElement("div",{className:"file-location"},r.a.createElement("strong",null,t),r.a.createElement("span",null," ",i)))))})),n.state={},n.delegate=k.get().getDelegate(),n}return g()(t,e),h()(t,[{key:"revokePreview",value:function(){this.state.previewUrl&&k.get().filesafe.revokeTempUrl(this.state.previewUrl),this.setState({previewUrl:null,previewingFile:null})}},{key:"flashErrorForFileDescriptor",value:function(e,t){var n=this;this.setStatusForFile(e,t,!1),setTimeout((function(){n.setStatusForFile(null)}),2500)}},{key:"render",value:function(){var e=this;return this.props.files.map((function(t){return e.elementForFile(t)}))}},{key:"supportsPreviews",get:function(){if(void 0!==this._supportsPreview)return this._supportsPreview;var e=k.get().filesafe.getEnvironment();if(null==e)return!1;this._supportsPreview="web"==e}},{key:"isMobile",get:function(){return k.get().filesafe.isMobile()}}]),t}(r.a.Component),D=function(e){function t(e){var n;return l()(this,t),n=u()(this,d()(t).call(this,e)),w()(y()(n),"event_preventDefaults",(function(e){e.preventDefault(),e.stopPropagation()})),w()(y()(n),"event_highlight",(function(e){n.event_preventDefaults(e),n.rootElement.classList.add("highlight")})),w()(y()(n),"event_unhighlight",(function(e){n.event_preventDefaults(e),n.rootElement.classList.remove("highlight")})),w()(y()(n),"event_drop",(function(e){n.event_unhighlight(e),n.event_preventDefaults(e);var t=e.dataTransfer.files;n.handleDroppedFiles(t)})),w()(y()(n),"handleDroppedFiles",(function(e){var t,a,r,i,s,o;return N.a.async((function(l){for(;;)switch(l.prev=l.next){case 0:if(0!=k.get().filesafe.getAllIntegrations().length){l.next=3;break}return alert("Please set up at least one integration before attempting to upload a file. To do this, press Expand, and select Add New in the Integrations section."),l.abrupt("return");case 3:t=!0,a=!1,r=void 0,l.prev=6,i=e[Symbol.iterator]();case 8:if(t=(s=i.next()).done){l.next=17;break}if(o=s.value){l.next=12;break}return l.abrupt("continue",14);case 12:return l.next=14,N.a.awrap(n.readFile(o));case 14:t=!0,l.next=8;break;case 17:l.next=23;break;case 19:l.prev=19,l.t0=l.catch(6),a=!0,r=l.t0;case 23:l.prev=23,l.prev=24,t||null==i.return||i.return();case 26:if(l.prev=26,!a){l.next=29;break}throw r;case 29:return l.finish(26);case 30:return l.finish(23);case 31:case"end":return l.stop()}}),null,null,[[6,19,23,31],[24,,26,30]])})),n.messagesManager=new x({credentialManager:k.get().filesafe.credentialManager,integrationManager:k.get().filesafe.integrationManager}),n.messagesManager.getMessages().then((function(e){n.setState({messages:e})})),n.state={noteFiles:k.get().filesafe.fileDescriptorsForCurrentNote(),messages:[]},k.get().addDataChangeObserver((function(){n.reload()})),k.get().addUnloadHandler((function(){window.removeEventListener("dragenter",n.event_highlight,!1),window.removeEventListener("dragover",n.event_highlight,!1),window.removeEventListener("dragleave",n.event_unhighlight,!1),window.removeEventListener("drop",n.event_drop,!1)})),n}return g()(t,e),h()(t,[{key:"reload",value:function(){var e;return N.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,N.a.awrap(this.messagesManager.getMessages());case 2:e=t.sent,this.setState({noteFiles:k.get().filesafe.fileDescriptorsForCurrentNote(),messages:e});case 4:case"end":return t.stop()}}),null,this)}},{key:"componentDidMount",value:function(){this.configureFileForm(),window.addEventListener("dragenter",this.event_highlight,!1),window.addEventListener("dragover",this.event_highlight,!1),window.addEventListener("dragleave",this.event_unhighlight,!1),window.addEventListener("drop",this.event_drop,!1)}},{key:"configureFileForm",value:function(){var e=this,t=this.fileInput;this.dropContainer;t&&(t.onchange=function(t){var n=t.target.files;e.handledFiles||e.handleDroppedFiles(n)})}},{key:"reset",value:function(){this.setState({rawData:null,decryptedItems:null,requestPassword:!1})}},{key:"readFile",value:function(e){var t=this;return N.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return 50,1e6,5e7,n.abrupt("return",new Promise((function(n,a){var r=new FileReader,i=!1;r.onload=function(a){var r,s,o,l;return N.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:if(r=a.target.result,!i){c.next=7;break}r=JSON.parse(r),s=r.items[0],t.decryptDraggedFile(s).then(n),c.next=20;break;case 7:if(!((o=r).byteLength>5e7)){c.next=14;break}return alert("The maximum upload size is ".concat(50," megabytes per file.")),t.setState({status:null}),n(),c.abrupt("return");case 14:return c.next=16,N.a.awrap(SFJS.crypto.arrayBufferToBase64(o));case 16:return l=c.sent,c.next=19,N.a.awrap(t.encryptFile(l,e.name,e.type));case 19:n();case 20:case"end":return c.stop()}}))},t.setState({status:"Reading file..."}),e.name.endsWith(".sf")||e.name.endsWith(".json")?(i=!0,r.readAsText(e)):r.readAsArrayBuffer(e)})));case 4:case"end":return n.stop()}}))}},{key:"decryptDraggedFile",value:function(e){var t,n,a,r,i,s,o,l,c=this;return N.a.async((function(u){for(;;)switch(u.prev=u.next){case 0:this.setState({status:"Decrypting..."}),t=k.get().filesafe.getAllCredentials(),n=function(t){return N.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise((function(n,a){k.get().filesafe.decryptFile({fileItem:e,credential:t}).then((function(e){var t=e.decryptedItem;k.get().filesafe.downloadBase64Data({base64Data:e.decryptedData,fileName:t.content.fileName,fileType:t.content.fileType}),c.setState({status:null}),n(!0)})).catch((function(e){console.error("Error decrypting:",e),c.flashError("Error decrypting file."),a(!1)}))})));case 1:case"end":return n.stop()}}))},a=!0,r=!1,i=void 0,u.prev=6,s=t[Symbol.iterator]();case 8:if(a=(o=s.next()).done){u.next=18;break}return l=o.value,u.next=12,N.a.awrap(n(l));case 12:if(!u.sent){u.next=15;break}return u.abrupt("return");case 15:a=!0,u.next=8;break;case 18:u.next=24;break;case 20:u.prev=20,u.t0=u.catch(6),r=!0,i=u.t0;case 24:u.prev=24,u.prev=25,a||null==s.return||s.return();case 27:if(u.prev=27,!r){u.next=30;break}throw i;case 30:return u.finish(27);case 31:return u.finish(24);case 32:case"end":return u.stop()}}),null,this,[[6,20,24,32],[25,,27,31]])}},{key:"wait",value:function(e){return N.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){setTimeout((function(){t()}),1e3*e)})));case 1:case"end":return t.stop()}}))}},{key:"encryptFile",value:function(e,t,n){var a,r,i=this;return N.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:if(a=k.get().filesafe.getDefaultCredentials()){s.next=5;break}return this.setState({status:null}),alert("Please set up at least one key before attempting to upload a file. To do this, press Expand, and select Create New in the Keys section."),s.abrupt("return");case 5:if(r=k.get().filesafe.getDefaultIntegration()){s.next=10;break}return this.setState({status:null}),alert("Please set up at least one integration before attempting to upload a file. To do this, press Expand, and select Add New in the Integrations section."),s.abrupt("return");case 10:return this.setState({status:"Encrypting..."}),s.abrupt("return",k.get().filesafe.encryptFile({data:e,inputFileName:t,fileType:n,credential:a}).then((function(e){return N.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:return i.setState({status:"Uploading to ".concat(k.get().filesafe.displayStringForIntegration(r),"...")}),s.next=3,N.a.awrap(i.wait(.5));case 3:return s.abrupt("return",k.get().filesafe.uploadFile({fileItem:e,inputFileName:t,fileType:n,credential:a}).then((function(){i.setState({status:"Upload Success."}),setTimeout((function(){i.setState({status:null})}),2e3)})).catch((function(e){console.error("fs-embed | error uploading file:",e),i.flashError("Error uploading file.")})));case 4:case"end":return s.stop()}}))})));case 12:case"end":return s.stop()}}),null,this)}},{key:"flashError",value:function(e){var t=this;this.setState({status:e,statusClass:"danger"}),setTimeout((function(){t.setState({status:null,statusClass:null})}),2500)}},{key:"render",value:function(){var e=this,t=this.state.statusClass?this.state.statusClass:"info",n="info"==t;return r.a.createElement("div",{className:"sn-component files-view"},r.a.createElement("div",{className:"sk-panel-row align-top"},r.a.createElement("div",{className:"files"},this.state.messages.length>0&&r.a.createElement("div",{id:"messages-container",className:"sk-panel-section"},r.a.createElement(S,{messages:this.state.messages})),this.state.status&&r.a.createElement("div",{id:"file-upload-status",className:"sk-horizontal-group"},n&&r.a.createElement("div",{className:"sk-spinner info small"}),r.a.createElement("div",{className:t},this.state.status)),r.a.createElement("div",{id:"add-file-button-container"},r.a.createElement("div",{className:"file sk-button info"},r.a.createElement("label",{className:"no-style"},r.a.createElement("input",{type:"file",style:{display:"none"},onChange:function(t){e.handleDroppedFiles(t.target.files)}}),r.a.createElement("div",{id:"attach-file-button-label",className:"sk-label"},"Attach File")))),r.a.createElement(C,{files:this.state.noteFiles}))))}},{key:"rootElement",get:function(){return document.getElementById("filesafe-embed")}},{key:"dropContainer",get:function(){return document.getElementById("files-view")}},{key:"fileInput",get:function(){return document.getElementById("file-input")}}]),t}(r.a.Component),I=function(e){function t(e){var n;return l()(this,t),n=u()(this,d()(t).call(this,e)),w()(y()(n),"toggleVisibility",(function(){n.setState({expanded:!n.state.expanded})})),n.state={expanded:!1,files:k.get().filesafe.getAllFileDescriptors()||[]},k.get().addDataChangeObserver((function(){n.setState({files:k.get().filesafe.getAllFileDescriptors()})})),n}return g()(t,e),h()(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"files-view"},r.a.createElement("div",{className:"sk-panel-row justify-left"},r.a.createElement("div",{className:"sk-horizontal-group"},r.a.createElement("div",{className:"sk-panel-section-title"},"All Files ",r.a.createElement("span",{style:{fontWeight:"normal"}},"(",this.state.files.length,")")),r.a.createElement("a",{className:"info",onClick:this.toggleVisibility},this.state.expanded?"Hide":"Show"))),this.state.expanded&&r.a.createElement("div",{className:"sk-panel-row"},r.a.createElement("div",{className:"files"},r.a.createElement(C,{files:this.state.files}))))}}]),t}(r.a.Component),_=function(e){function t(e){var n;return l()(this,t),n=u()(this,d()(t).call(this,e)),w()(y()(n),"handleKeyPress",(function(e){"Enter"===e.key&&n.submitIntegrationCode()})),w()(y()(n),"handleTextChange",(function(e){var t=e.target.value;n.setState({integrationCode:t})})),w()(y()(n),"submitIntegrationCode",(function(){var e=n.state.integrationCode;e&&0!=e.length&&k.get().filesafe.saveIntegrationFromCode(e).then((function(){n.setState({integrationCode:null,showInputForm:!1}),n.reloadIntegrations()})).catch((function(){alert("Invalid integration code. Ensure the correct value is copied and try again.")}))})),w()(y()(n),"addNewIntegrationClicked",(function(){window.open(k.get().defaultRelayServerUrl(),"_blank"),n.setState({showInputForm:!0})})),w()(y()(n),"cancelIntegrationForm",(function(){n.setState({showInputForm:!1})})),w()(y()(n),"deleteIntegration",(function(e){k.get().filesafe.deleteIntegration(e)})),w()(y()(n),"setIntegrationAsDefaultUploadSource",(function(e){k.get().filesafe.setIntegrationAsDefault(e)})),n.state={integrations:k.get().filesafe.getAllIntegrations()||[]},k.get().addDataChangeObserver((function(){n.reloadIntegrations()})),n}return g()(t,e),h()(t,[{key:"reloadIntegrations",value:function(){var e=k.get().filesafe.getAllIntegrations();this.setState({integrations:e})}},{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){}},{key:"displayStringForIntegration",value:function(e){return k.get().filesafe.displayStringForIntegration(e)}},{key:"render",value:function(){var e=this,t=this.state.integrations.length>1;return r.a.createElement("div",null,r.a.createElement("div",{className:"sk-panel-row"},r.a.createElement("div",{className:"sk-h2 sk-bold"},"Integrations"),!this.state.showInputForm&&r.a.createElement("div",{className:"sk-button info no-border",onClick:this.addNewIntegrationClicked},r.a.createElement("div",{className:"sk-label"},"Add New"))),r.a.createElement("div",{id:"integrations"},this.state.showInputForm&&r.a.createElement("div",{className:"sk-notification info"},r.a.createElement("strong",null,"New Integration"),r.a.createElement("p",{className:"sk-p"},"A new tab has opened. After you complete the authentication flow, enter the code you receive below."),r.a.createElement("div",{className:"sk-panel-row"}),r.a.createElement("input",{className:"title sk-input contrast",type:"text",placeholder:"Enter integration code",value:this.state.integrationCode,onChange:this.handleTextChange,onKeyPress:this.handleKeyPress}),r.a.createElement("div",{className:"sk-button-group",style:{marginTop:10}},r.a.createElement("div",{className:"sk-button neutral",onClick:this.cancelIntegrationForm},r.a.createElement("a",{className:"sk-label"},"Cancel")),r.a.createElement("div",{className:"sk-button sk-base",onClick:this.submitIntegrationCode},r.a.createElement("a",{className:"sk-label"},"Submit"))))),r.a.createElement("div",{className:"list-container"},this.state.integrations.map((function(n){return r.a.createElement("div",{className:"list-item sk-horizontal-group top"},r.a.createElement("div",{className:"sk-circle x-small "+(n.content.isDefaultUploadSource?"info":"sk-secondary-contrast")}),r.a.createElement("div",null,r.a.createElement("div",{className:"sk-panel-row condensed sk-bold"},e.displayStringForIntegration(n)),r.a.createElement("div",{className:"sk-panel-row condensed"},r.a.createElement("div",{className:"sk-horizontal-group"},t&&!n.content.isDefaultUploadSource&&r.a.createElement("a",{className:"info",onClick:function(){e.setIntegrationAsDefaultUploadSource(n)}},"Make Default"),r.a.createElement("a",{className:"danger",onClick:function(){e.deleteIntegration(n)}},"Delete")))))}))))}}]),t}(r.a.Component),P=function(e){function t(e){var n;return l()(this,t),(n=u()(this,d()(t).call(this,e))).state={messages:[]},n}return g()(t,e),h()(t,[{key:"render",value:function(){return r.a.createElement("div",{id:"home",className:"sk-panel static"},r.a.createElement("div",{id:"main-content",className:"sk-panel-content"},r.a.createElement("div",{className:"sk-panel-section"},r.a.createElement(D,null)),r.a.createElement("div",{className:"sk-panel-section"},r.a.createElement(_,null)),r.a.createElement("div",{className:"sk-panel-section"},r.a.createElement(E,null)),r.a.createElement("div",{className:"sk-panel-section"},r.a.createElement(I,null))))}}]),t}(r.a.Component),O=function(e){function t(e){return l()(this,t),u()(this,d()(t).call(this,e))}return g()(t,e),h()(t,null,[{key:"renderInElement",value:function(e,n,a){k.get().setFilesafeInstance(n),k.get().setDelegate(a),s.a.render(r.a.createElement(t),e)}},{key:"unload",value:function(e){k.get().unload(),s.a.unmountComponentAtNode(e)}}]),h()(t,[{key:"render",value:function(){return r.a.createElement("div",{id:"filesafe-embed"},r.a.createElement("div",{className:"sn-component"},r.a.createElement(P,null)))}}]),t}(r.a.Component);t.default={FilesafeEmbed:O,React:r.a,ReactDOM:s.a}}]);